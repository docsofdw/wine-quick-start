---
import ImagePlaceholder from '../ui/ImagePlaceholder.astro';

interface Article {
  title: string;
  slug: string;
  description?: string;
  category?: string;
  imagePrompt?: string;
  basePath?: string;
}

interface Props {
  articles: Article[];
  title?: string;
}

const { articles, title = 'Related Articles' } = Astro.props;

// Generate default prompts based on article title
function getDefaultPrompt(articleTitle: string): string {
  const lowerTitle = articleTitle.toLowerCase();

  if (lowerTitle.includes('salmon') || lowerTitle.includes('seafood') || lowerTitle.includes('fish')) {
    return `Fresh grilled salmon with white wine glass, elegant restaurant setting, soft natural lighting, professional food photography --ar 16:9 --v 6`;
  }
  if (lowerTitle.includes('steak') || lowerTitle.includes('beef') || lowerTitle.includes('meat')) {
    return `Perfectly seared steak with bold red wine in crystal glass, dark moody lighting, rustic wooden table --ar 16:9 --v 6`;
  }
  if (lowerTitle.includes('pasta') || lowerTitle.includes('italian') || lowerTitle.includes('risotto')) {
    return `Authentic Italian pasta dish with wine, traditional trattoria setting, warm ambient lighting --ar 16:9 --v 6`;
  }
  if (lowerTitle.includes('pinot') || lowerTitle.includes('cabernet') || lowerTitle.includes('merlot')) {
    return `Elegant glass of red wine with vineyard backdrop, warm golden hour lighting, wine photography --ar 16:9 --v 6`;
  }
  if (lowerTitle.includes('chardonnay') || lowerTitle.includes('sauvignon') || lowerTitle.includes('riesling')) {
    return `Glass of white wine in elegant setting, bright natural lighting, refreshing summer mood --ar 16:9 --v 6`;
  }
  if (lowerTitle.includes('region') || lowerTitle.includes('bordeaux') || lowerTitle.includes('burgundy') || lowerTitle.includes('napa')) {
    return `Rolling vineyard hills at golden hour, dramatic landscape, wine country photography --ar 16:9 --v 6`;
  }

  // Default
  return `Wine glass with gourmet food pairing, elegant restaurant setting, soft natural lighting, professional photography --ar 16:9 --v 6`;
}
---

{articles.length > 0 && (
  <section class="mt-16 pt-12 border-t border-gray-200">
    <h2 class="font-serif text-2xl font-bold text-gray-900 mb-8">
      {title}
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {articles.slice(0, 3).map((article) => {
        const basePath = article.basePath || '/wine-pairings';
        return (
          <a
            href={`${basePath}/${article.slug}/`}
            class="group block rounded-xl overflow-hidden bg-white border border-gray-100
                   hover:shadow-lg hover:-translate-y-1 transition-all duration-300"
          >
            <div class="aspect-[16/10] overflow-hidden">
              <ImagePlaceholder
                prompt={article.imagePrompt || getDefaultPrompt(article.title)}
                aspectRatio="16:9"
                alt={article.title}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 !rounded-none"
              />
            </div>
            <div class="p-4">
              {article.category && (
                <span class="text-xs text-wine-600 font-medium uppercase tracking-wide">
                  {article.category}
                </span>
              )}
              <h3 class="font-semibold text-gray-900 mt-1 group-hover:text-wine-600 transition-colors line-clamp-2">
                {article.title}
              </h3>
              {article.description && (
                <p class="text-sm text-gray-600 mt-2 line-clamp-2">
                  {article.description}
                </p>
              )}
            </div>
          </a>
        );
      })}
    </div>
  </section>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
